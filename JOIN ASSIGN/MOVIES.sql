CREATE DATABASE MOVIESS;
USE MOVIESS;
DROP DATABASE MOVIESS;


CREATE TABLE ACTOR(ACT_ID INT NOT NULL,
					ACT_NAME VARCHAR(20) NOT NULL,
                    ACT_GENDER VARCHAR(20) NOT NULL);
CREATE TABLE DIRECTOR(DIR_ID VARCHAR(20) NOT NULL,
					DIR_NAME VARCHAR(20) NOT NULL,
                    DIR_PHONE INT NOT NULL);
CREATE TABLE MOVIES(MOV_ID INT NOT NULL,
					MOV_TITLE VARCHAR(20) NOT NULL,
                    MOV_YEAR INT NOT NULL,
                    MOV_LANG VARCHAR(10) NOT NULL,
                    DIR_ID INT NOT NULL);
CREATE TABLE MOVIE_CAST(ACT_ID INT NOT NULL,
					MOV_ID INT NOT NULL,
                    ROLE VARCHAR(20) NOT NULL);
INSERT INTO ACTOR(ACT_ID,ACT_NAME,ACT_GENDER )VALUES("1","TOM","FEMALE");
INSERT INTO ACTOR(ACT_ID,ACT_NAME,ACT_GENDER )VALUES("2","JEFRI","MALE");
INSERT INTO ACTOR(ACT_ID,ACT_NAME,ACT_GENDER )VALUES("12","JERI","MALE");
INSERT INTO ACTOR(ACT_ID,ACT_NAME,ACT_GENDER )VALUES("3","KEVIN","FEMALE");
SELECT * FROM  ACTOR; 

INSERT INTO DIRECTOR(DIR_ID,DIR_NAME,DIR_PHONE )VALUES("4","HITCHCOCK","974789");
INSERT INTO DIRECTOR(DIR_ID,DIR_NAME,DIR_PHONE )VALUES("5","STEVEN SPIELBERG","56789");
SELECT *FROM DIRECTOR;

INSERT INTO MOVIES(MOV_ID,MOV_TITLE,MOV_YEAR,MOV_LANG,DIR_ID)VALUES("6","GODFATHER","2000","ENG","4");
INSERT INTO MOVIES(MOV_ID,MOV_TITLE,MOV_YEAR,MOV_LANG,DIR_ID)VALUES("7","INCEPTION","1968","ENG","5");
INSERT INTO MOVIES(MOV_ID,MOV_TITLE,MOV_YEAR,MOV_LANG,DIR_ID)VALUES("8","12ANGRYMEN","2015","ENG","4");
INSERT INTO MOVIES(MOV_ID,MOV_TITLE,MOV_YEAR,MOV_LANG,DIR_ID)VALUES("10","RRR","2019","ENG","9");
INSERT INTO MOVIES(MOV_ID,MOV_TITLE,MOV_YEAR,MOV_LANG,DIR_ID)VALUES("9","DARKKNIGHT","2017","ENG","5");

SELECT * FROM MOVIES;

INSERT INTO MOVIE_CAST(ACT_ID,MOV_ID,ROLE)VALUES("1","6","SAILOR");
INSERT INTO MOVIE_CAST(ACT_ID,MOV_ID,ROLE)VALUES("3","7","ENGINEER");
INSERT INTO MOVIE_CAST(ACT_ID,MOV_ID,ROLE)VALUES("3","6","PIRAT");
INSERT INTO MOVIE_CAST(ACT_ID,MOV_ID,ROLE)VALUES("3","8","DOCTOR");
INSERT INTO MOVIE_CAST(ACT_ID,MOV_ID,ROLE)VALUES("2","8","CAPTAIN");
INSERT INTO MOVIE_CAST(ACT_ID,MOV_ID,ROLE)VALUES("12","9","COOK");


CREATE TABLE RATING(MOV_ID VARCHAR(20) NOT NULL,
                    REV_STARS INT(20) NOT NULL);
INSERT INTO RATING(MOV_ID,REV_STARS)VALUES("6","6");
INSERT INTO RATING(MOV_ID,REV_STARS)VALUES("7","10");
INSERT INTO RATING(MOV_ID,REV_STARS)VALUES("7","11");
INSERT INTO RATING(MOV_ID,REV_STARS)VALUES("7","15");
INSERT INTO RATING(MOV_ID,REV_STARS)VALUES("8","8");
INSERT INTO RATING(MOV_ID,REV_STARS)VALUES("9","9");


SELECT MOV_TITLE ,DIR_NAME
FROM MOVIES JOIN DIRECTOR ON
MOVIES.DIR_ID = DIRECTOR.DIR_ID
WHERE DIR_NAME="HITCHCOCK";
 
 SELECT MOVIES.MOV_TITLE,ACTORACT_NAME FROM ACTOR JOIN  MOVIE_CAST ON MOVIE_CAST.ACT_ID =ACTOR.ACT_ID
	JOIN MOVIES ON MOVIE_CAST.MOV_ID=MOVIES.MOV_ID WHERE ACTOR. act_id = (
SELECT ACT_ID FROM ACTOR JOIN  movie_cast ON ACTOR.ACT_ID=MOVIE_CAST.ACT_ID JOIN MOVIES ON MOVIE_CAST.MOV_ID=MOVIES.MOV_ID GROUP BY ACTOR.act_id HAVING COUNT(MOVIE_TITLE)>1);

select movies.mov_title,actor.act_id from
actor join movie_cast on actor.act_id=movie_cast.act_id
join movies on  movie_cast.mov_id=movies.mov_id  
where actor.act_id=( select actor.act_id from
actor join movie_cast on actor.act_id=movie_cast.act_id
join movies on  movie_cast.mov_id=movies.mov_id group by actor.act_id having count(mov_title)>1);



SELECT ACT_NAME,MOV_YEAR FROM ACTOR JOIN MOVIE_CAST ON MOVIE_CAST.ACT_ID =ACTOR.ACT_ID
							JOIN MOVIES ON MOVIE_CAST .MOV_ID=MOVIES.MOV_ID
                            
                            WHERE MOV_YEAR<2000 OR MOV_YEAR>2015;
SELECT MOV_TITLE,MAX(REV_STARS) FROM MOVIES JOIN RATING ON RATING.MOV_ID=MOVIES.MOV_ID
					WHERE MOV_TITLE IN(SELECT MOV_TITLE FROM MOVIES GROUP BY MOV_ID HAVING MAX(REV_STARS>0)  ORDER BY MOV_TITLE);
SELECT MOV_TITLE ,MAX(REV_STARS) FROM MOVIES INNER JOIN RATING USING(MOV_ID) GROUP BY MOV_TITLE HAVING MAX(REV_STARS)>0 ORDER BY MOV_TITLE;

SET SQL_SAFE_UPDATES=0;
UPDATE RATING SET REV_STARS="5" WHERE MOV_ID IN(SELECT MOV_ID FROM MOVIES JOIN DIRECTOR ON MOVIES.DIR_ID=DIRECTOR.DIR_ID WHERE DIRECTOR. DIR_NAME="STEVEN SPIELBERG");

SELECT REV_STARS,MOV_ID FROM RATING WHERE MOV_ID=7;